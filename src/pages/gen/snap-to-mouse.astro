---
import Circle from "@lib/components/svg/builtin/Circle.astro";
import BaseLayout from "@lib/layouts/BaseLayout.astro";
---

<BaseLayout title="timeline" fullScreen={true}>
    <svg id="svg" viewBox="-100 -100 200 200">
        <g transform="" id="circle-parent">
            <g>
                <Circle r={4} fill="currentColor" />
            </g>
        </g>
    </svg>
</BaseLayout>

<style>
    svg {
        height: 100%;
        width: 100%;
        outline: 1px currentColor solid;
        cursor: none;
    }

    svg circle {
        animation-duration: 100ms;
        animation-fill-mode: both;
    }

    svg:hover circle {
        animation-name: enter;
        animation-delay: 0ms;
        /* animation-timing-function: ease-out; */
    }

    svg:not(:hover) circle {
        animation-name: exit;
        animation-delay: 150ms;
        animation-duration: 350ms;
        /* animation-timing-function: ease-in-out; */
    }

    @keyframes enter {
        from {
            transform: translate(0px, 0px);
        }
        to {
            transform: translate(var(--x, 0px), var(--y, 0px));
        }
    }

    @keyframes exit {
        from {
            transform: translate(var(--x, 0), var(--y, 0));
        }
        to {
            transform: translate(0px, 0px);
        }
    }
</style>

<script>
    function attachHandler() {
        const svg: SVGSVGElement = document.querySelector("main svg");

        const circleParent: SVGGElement = svg.querySelector("#circle-parent");

        svg.addEventListener("mousemove", (e) => {
            let x = e.clientX;
            let y = e.clientY;
            let box = svg.getBoundingClientRect();

            let aspectRatio = box.width / box.height;

            x -= box.x;
            y -= box.y;

            let fx = x / box.width;
            let fy = y / box.height;

            let svgX = (200 * fx - 100) * (aspectRatio > 1 ? aspectRatio : 1);
            let svgY = (200 * fy - 100) / (aspectRatio < 1 ? aspectRatio : 1);

            circleParent.style.setProperty("--x", `${svgX}px`);
            circleParent.style.setProperty("--y", `${svgY}px`);
        });
    }

    document.addEventListener("astro:page-load", attachHandler);
</script>
