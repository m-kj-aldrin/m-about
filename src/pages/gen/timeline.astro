---
import AnimateTransform from "@lib/components/svg/animations/AnimateTransform.astro";
import Circle from "@lib/components/svg/builtin/Circle.astro";
import BaseLayout from "@lib/layouts/BaseLayout.astro";
---

<BaseLayout title="timeline" fullScreen={true}>
    <svg viewBox="-256 -256 512 512" id="svg">
        <g transform="" id="circle-parent">
            <g>
                <Circle r={4} />
            </g>
        </g>
    </svg>
</BaseLayout>

<style>
    svg {
        height: 100%;
        width: 100%;
        outline: 1px red solid;
        background-color: white;
    }

    svg circle {
        animation-duration: 100ms;
        animation-fill-mode: both;
    }

    svg:hover circle {
        animation-name: enter;
        animation-delay: 0ms;
        /* animation-timing-function: ease-out; */
    }

    svg:not(:hover) circle {
        animation-name: exit;
        animation-delay: 150ms;
        animation-duration: 350ms;
        /* animation-timing-function: ease-in-out; */
    }

    @keyframes enter {
        from {
            transform: translate(0px, 0px);
        }
        to {
            transform: translate(var(--x, 0px), var(--y, 0px));
        }
    }

    @keyframes exit {
        from {
            transform: translate(var(--x, 0), var(--y, 0));
        }
        to {
            transform: translate(0px, 0px);
        }
    }
</style>

<script>
    const svg: SVGSVGElement = document.querySelector("main svg");

    const circle: SVGCircleElement = svg.querySelector("#circle");
    const circleParent: SVGGElement = svg.querySelector("#circle-parent");

    const animation: SVGAnimateTransformElement = svg.querySelector("#ani");

    svg.addEventListener("mousemove", (e) => {
        let x = e.clientX;
        let y = e.clientY;
        let box = svg.getBoundingClientRect();

        let aspectRatio = box.width / box.height;

        x -= box.x;
        y -= box.y;

        let fx = x / box.width;
        let fy = y / box.height;

        let svgX = (fx * 512 - 256) * aspectRatio;
        let svgY = fy * 512 - 256;

        circleParent.style.setProperty("--x", `${svgX}px`);
        circleParent.style.setProperty("--y", `${svgY}px`);
    });
</script>
