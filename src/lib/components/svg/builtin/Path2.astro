---
import type { HTMLAttributes } from 'astro/types';

import transformString, { type Transform } from './transformString';

type MoveCommand = ['m' | 'M', number, number];
type LineCommand = ['l' | 'L', number, number];
type VerticalCommand = ['v' | 'V', number];
type HorizontalCommand = ['h' | 'H', number];
type QuadraticBezierCurveCommand = ['q' | 'Q', number, number, number, number];
type QuadraticBezierCurveShortCommand = ['t' | 'T', number, number];

// rx, ry, angle, large-arc-flag, sweep-flag, x, y
type ArcCommand = ['a' | 'A', number, number, number, number, number, number, number];

export type Command = MoveCommand | LineCommand | VerticalCommand | HorizontalCommand | ArcCommand | QuadraticBezierCurveCommand | QuadraticBezierCurveShortCommand;

type Tail<T extends any[]> = T extends [any, ...infer R] ? R : never;

export type CommandNames = Command[0];
export type CommandValues = Tail<Command>;

interface Props extends Transform, Omit<HTMLAttributes<'path'>, 'rotate' | 'scale' | 'd'> {
  d: Command[];
}

const { d: _d, scale, rotate, translate, ...attrs } = Astro.props;
let transform: string | undefined = '';
if (!attrs['transform']) {
  transform = transformString({ scale, rotate, translate });
}

const firstCommand = _d[0];
if (firstCommand[0].toLocaleLowerCase() !== 'm') {
  _d.unshift(['M', 0, 0]);
}
const d = _d.map((command) => command[0] + command.slice(1).join(' ')).join(',');
---

<path {d} {transform} {...attrs}>
  <slot />
</path>
